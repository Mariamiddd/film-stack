<div class="details-view">
    @if (isLoading()) {
    <div class="loading-state-minimal">
        <div class="spinner-minimal"></div>
        <p>Calibrating Content...</p>
    </div>
    } @else if (errorMessage()) {
    <div class="error-container-figma card-flat">
        <p>{{ errorMessage() }}</p>
        <button (click)="goBack()" class="btn-figma btn-primary-figma">Return to Catalog</button>
    </div>
    } @else {
    @let m = movie();
    @if (m) {
    <!-- Cinematic Backdrop -->
    <div class="movie-hero-backdrop" [style.background-image]="'url(' + getBackdropUrl(m.backdrop_path) + ')'">
        <div class="hero-gradient"></div>
    </div>

    <div class="details-workspace grid-system">
        <!-- Sidebar Panel (3 columns) -->
        <div class="details-sidebar">
            <div class="poster-frame card-flat">
                <img [src]="getPosterUrl(m.poster_path)" [alt]="m.title || m.name" class="movie-poster" />
                @if (hasPurchased()) {
                <div class="status-indicator">Licensed</div>
                }
            </div>

            <div class="action-panel card-flat">
                <div class="panel-section">
                    @if (!hasPurchased()) {
                    <span class="label">Purchase Access</span>
                    <span class="value">$4.99 USD</span>
                    } @else {
                    <span class="label">Library Status</span>
                    <span class="value">Ready for playback</span>
                    }
                </div>

                <div class="action-group">
                    @if (!hasPurchased()) {
                    <button class="btn-figma btn-primary-figma" (click)="purchaseMovie()" [disabled]="isPurchasing()">
                        @if (isPurchasing()) { <div class="spinner-minimal" style="width: 14px; height: 14px;"></div> }
                        @else { Confirm Purchase }
                    </button>
                    } @else {
                    <button class="btn-figma btn-primary-figma" (click)="toggleTrailer()">
                        {{ showTrailer() ? 'Stop Stream' : 'Start Stream' }}
                    </button>
                    }

                    <div class="utility-actions">
                        <button class="btn-figma btn-outline-figma" (click)="toggleWishlist()"
                            [class.active]="isInWishlist()">
                            {{ isInWishlist() ? 'In Library' : 'Add to Library' }}
                        </button>
                        <button class="btn-figma btn-outline-figma" (click)="toggleFavorite()"
                            [class.active]="isInFavorites()">
                            {{ isInFavorites() ? 'Favorite' : 'Save' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content (9 columns) -->
        <div class="details-main">
            <button class="back-link" (click)="goBack()">‚Üê Workspace / Catalog</button>

            <div class="meta-header">
                <div class="meta-line">
                    <span>{{ (m.release_date || m.first_air_date) | date:'yyyy' }}</span>
                    <span class="dot"></span>
                    <span>{{ (m.original_language || 'en') | uppercase }}</span>
                    @if (m.runtime) {
                    <span class="dot"></span>
                    <span>{{ m.runtime }} MIN</span>
                    }
                </div>
                <h1 class="details-title">{{ m.title || m.name }}</h1>
                <div class="rating-indicator">
                    <span class="label">Audience Score</span>
                    <span class="score">{{ m.vote_average | number:'1.1-1' }} / 10</span>
                </div>
            </div>

            <section class="info-section">
                <h3>Synopsis</h3>
                <p class="summary-text">{{ m.overview }}</p>
            </section>

            @if (cast().length > 0) {
            <section class="info-section">
                <h3>Principles</h3>
                <div class="principles-grid">
                    @for (actor of cast(); track actor.id) {
                    <div class="principle-card">
                        <div class="principle-img">
                            <img [src]="getCastImageUrl(actor.profile_path)" [alt]="actor.name">
                        </div>
                        <div class="principle-info">
                            <span class="p-name">{{ actor.name }}</span>
                            <span class="p-role">{{ actor.character }}</span>
                        </div>
                    </div>
                    }
                </div>
            </section>
            }

            @if (showTrailer() && hasPurchased()) {
            <section class="playback-section card-flat">
                <div class="playback-header">
                    <h3>Secure Stream</h3>
                    <button class="close-btn" (click)="toggleTrailer()">Close</button>
                </div>
                <div class="playback-container">
                    <iframe [src]="getTrailerUrl()" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            </section>
            }
        </div>
    </div>
    }
    }
</div>