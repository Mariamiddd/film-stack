<div class="home-view">

  @if (isLoading()) {
  <app-loader></app-loader>
  }

  <!-- Content Workspace -->
  <div class="workspace-layout grid-system">

    <!-- Main Content Area (Now span 12 for better horizontal flow) -->
    <div class="workspace-main col-span-12">
      <!-- Section: Mood Recommendations -->
      <section class="workspace-section card-flat">
        <header class="ws-header">
          <div class="ws-header-top">
            <div class="ws-header-title">
              <h2>Current Selections</h2>
              <p class="ws-header-sub">Hand-picked for your {{ currentMood().label }} vibe</p>
            </div>
            <a routerLink="/movies" class="ws-link-more">Full Catalog →</a>
          </div>

          <div class="ws-controls">
            <div class="filter-row-figma">
              <div class="filter-group-left">
                <app-figma-select title="Mood" [options]="moodOptions" [value]="currentMood().value.toString()"
                  defaultValue="50" (valueChange)="themeService.setMood(+$event)">
                </app-figma-select>
              </div>

              <div class="filter-group-right">
                <app-figma-select title="Intensity" [options]="intensityOptions" [value]="intensity()"
                  defaultValue="Balanced" (valueChange)="setIntensity($any($event))">
                </app-figma-select>

                <app-figma-select title="Genre" [options]="subGenreOptions()" [value]="activeGenre() || ''"
                  defaultValue="" [alignRight]="true" (valueChange)="toggleGenre($event)">
                </app-figma-select>
              </div>
            </div>
          </div>
        </header>
        <div class="scroll-wrapper">
          <div class="scroll-controls">
            <button class="scroll-btn prev" (click)="scrollMovies('left')" aria-label="Scroll Left">
              <span class="vcr-icon">‹</span>
            </button>
            <button class="scroll-btn next" (click)="scrollMovies('right')" aria-label="Scroll Right">
              <span class="vcr-icon">›</span>
            </button>
          </div>

          <div class="ws-grid-inner scroll-container" #scrollContainer>
            @for (movie of validMovies(); track movie.id) {
            <app-movie-card [movie]="movie" [type]="movie.media_type === 'tv' ? 'tv' : 'movie'"></app-movie-card>
            }
          </div>
        </div>
      </section>
    </div>
    @if (errorMessage()) {
    <div class="error-container-figma card-flat">
      <p>{{ errorMessage() }}</p>
      <button (click)="refreshContent()" class="btn-figma btn-primary-figma">Retry Sequence</button>
    </div>
    }
  </div>